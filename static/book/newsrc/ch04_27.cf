bundle agent wp_is_properly_configured(params)
{
  vars:
      "allparams" slist => getindices("$(params)"); # <1>
    secondpass::
      "wpparams"  slist => grep("[^_].*", "allparams");

  classes:
      "secondpass" expression => isvariable("allparams");

  files:
      "$($(params)[_wp_config])" # <2>
        edit_line =>
          replace_or_add(
           "define\('$(wpparams)', *(?!'$($(params)[$(wpparams)]))'.*",
           "define('$(wpparams)', '$($(params)[$(wpparams)])');");
}
